# Cloud Build Config for Fathom use
# gcr.io -> us.gcr.io migration design doc
# https://docs.google.com/document/d/1gox2x_WggIn4cUNirgjQdrmYehd-x6QMc6eE8EsZkH0/edit?usp=sharing

timeout: 1200s
steps:
  - id: cos-gpu-installer
    name: "gcr.io/cloud-builders/docker"
    args: ["build", "-t", "gcr.io/$PROJECT_ID/cos-gpu-installer:latest", "."]
    dir: cos-gpu-installer-docker
    waitFor: ["-"]

  - id: us-cos-gpu-installer
    name: "gcr.io/cloud-builders/docker"
    args: [
      "build",
      "-t", "us.gcr.io/$PROJECT_ID/cos-gpu-installer:latest",
      "--cache-from", "gcr.io/$PROJECT_ID/cos-gpu-installer:latest",
      "."]
    dir: cos-gpu-installer-docker
    waitFor: ["-"]

images:
  - gcr.io/$PROJECT_ID/cos-gpu-installer
  - us.gcr.io/$PROJECT_ID/cos-gpu-installer
